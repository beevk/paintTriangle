<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Click position</title>

	<style type="text/css">
		#myCanvas {
			margin-left: 5%;
			margin-top: 0px;
		}
		#descr {
			margin-left: 85%;
			margin-top: -20%;
		}
	</style>
</head>
<body>
	<canvas id="title" height="100" width="1000">
		<p>Your Browser is not supported!</p>
	</canvas>
	<div id="functions">
		<div id="app">
			<canvas id="myCanvas" height="500" width="1000" style="border:5px solid #f047a2" onmousedown="downCordinates(event)" onmouseup="upCordinates(event)" ondblclick="searchTriangle(event)">
				<p>Your Browser is not supported!</p>
			</canvas>
		</div>
		<div id="descr">
			<button onclick="return clearAll()">Erase All</button>
		</div>
	</div>

	<script>
		var canvas = document.getElementById('title');
		var context = canvas.getContext('2d');

		//For writing the Heading Part
		context.font = '30px Comic Sans MS';
		context.fillStyle  = "red";
		context.textAlign = "center";
		context.fillText("Draw and Delete with double-click/Erase All!", canvas.width/2, canvas.height/2);

		var px, py;
		var redraw = 0;
		var x1, y1, x2, y2;
		var flag = 0;

		//To store each points of triangle drawn
		var p0 = [];
		var p1 = [];
		var p2 = [];

		var canvas = document.getElementById('myCanvas');
		var context = canvas.getContext('2d');

		function downCordinates(event) {
			var rect = canvas.getBoundingClientRect();
		    x1 = event.clientX - rect.left;
		    y1 = event.clientY - rect.top;
		    //console.log("Start: "+x1+","+y1);
		   
		}

		function upCordinates(event) {
		    var rect = canvas.getBoundingClientRect();
		    x2 = event.clientX - rect.left;
		    y2 = event.clientY - rect.top;
		    //Set flag to trigger the drawTriangle event
		    flag = 1;
		   
		}

		//Checks if co-ordinates are set for triangleDraw
		function flagChange() {
		    if(flag == 0) {
		        setTimeout(flagChange, 50);//wait 50 millisecnds, then re-check
		        return;
		    } 
		    else { 
			//Take largest drag along (X|Y) axis
			var length = Math.abs(x2-x1) < Math.abs(y2-y1) ? Math.abs(y2-y1) : Math.abs(x2-x1);

			//Take largest value for Y axis
			var y = y1 < y2 ? y2 : y1;

			if(x1!=x2 || y1!=y2)
				drawTriangle(x1,x1+length,y);

			flag = 0;
			flagChange();

			document.getElementById("demo").innerHTML = num;
		    }
		    
		    
		}

		flagChange();

		function drawTriangle(x1, x2, y1) {

				//Calculate Hypotenuse and Base
				var h = x2-x1;
				var b = h/2;

				//Calculate x3
				var x3 = x1 + b;

				//By Pythagoras theorem: P = sqrt(h*h - b*b);
				var p = Math.sqrt(h*h - b*b);
				var y2 = y1 - p;
				
				//Store co-ordinates for each triangle
				p0.push({x: x1, y: y1});
				p1.push({x: x2, y: y1});
				p2.push({x: x3, y: y2});

				context.beginPath();
				context.moveTo(x1, y1);
				context.lineTo(x2, y1);
				context.lineTo(x3, y2);
				context.closePath();

				context.lineWidth = 1;
				if(redraw == 1) {
					context.strokeStyle = '#ffffff';
				}else {
					context.strokeStyle = '#666666';
				}
				context.stroke();

				if(redraw == 1) {
					context.fillStyle = '#ffffff';
					redraw = 0;
 	
				} else {
					context.fillStyle = getRandomColor();
					
				}

				context.fill();
			}

			function getRandomColor() {
			    var letters = '0123456789ABCDEF';
			    var color = '#';
			    for (var i = 0; i < 6; i++ ) {
			        color += letters[Math.floor(Math.random() * 16)];
			    }
			    return color;
			}

			function clearAll() {
				context.clearRect(0, 0, canvas.width, canvas.height);
			}

			

			//Searches if double clicked position lies inside any triangle
			function searchTriangle(event) {

				var check;
				var length = p1.length;
				var rect = canvas.getBoundingClientRect();
			    px = event.clientX - rect.left;
			    py = event.clientY - rect.top;

			    //Using BaryCentric co-ordinates to check if point is inside triangle
				for(var i = 0; i<length; i++) {

					Area = 0.5 *(-p1[i].y*p2[i].x + p0[i].y*(-p1[i].x + p2[i].x) + p0[i].x*(p1[i].y - p2[i].y) + p1[i].x*p2[i].y);
					s = 1/(2*Area)*(p0[i].y*p2[i].x - p0[i].x*p2[i].y + (p2[i].y - p0[i].y)*px + (p0[i].x - p2[i].x)*py);
					t = 1/(2*Area)*(p0[i].x*p1[i].y - p0[i].y*p1[i].x + (p0[i].y - p1[i].y)*px + (p1[i].x - p0[i].x)*py);

					check = 1-s-t;

					if(s>0 && t>0 && check>0) {
						deleted = i;
						removePoints(i);	
						//break;
						/*Activate this break statement if, double click should delete only one triangle instead of deleting all triangles sharing common pixel*/
					}
				}
				return false;
			}

			//Deletes co-ordinates from array that stores points of triangles
			function removePoints(point) {
				//Matches the selected triangle with background color, so that it is invisible
				reDraw();

				for(var i=point;i<p1.length-1;i++) {
					p0[i] = p0[i+1];
					p1[i] = p1[i+1];
					p2[i] = p2[i+1];
				}

				p0.pop();
				p1.pop();
				p2.pop();
			}

			//OverDraw the old triangle, so that it becomes invisible
			function reDraw() {
				//Set flag indicating reDraw is for Hiding the original triangle
				redraw = 1;
				drawTriangle(p0[deleted].x-4,p1[deleted].x+4,p0[deleted].y+3);
			}

	</script>
</body>
</html>